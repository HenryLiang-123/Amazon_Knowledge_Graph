########################################
# Importing relevant packages
########################################
import os
import logging
import sys
import base64
from pathlib import Path
from configparser import ConfigParser
import neo4j
import openai
import langchain

import streamlit as st

# adding src to the system path
sys.path.insert(0, os.getcwd() + "/src")

from create_database import get_data, add_nodes_edges, create_graph

########################################
# main
########################################

# Setting config file 
config_file = 'config/config.ini'
configur = ConfigParser()
configur.read(config_file)

print("Let's create the database.")

st.title("Let's create the database.")
st.write("Please ensure that your data is in the repository.")
st.write("Please ensure that your data path is set correctly in the configuration.")

network = st.selectbox("Please select the network you would like to analyse?", ("EU Communication Network"))

file_path = None
if network == "EU Communication Network":
    file_path = configur.get('create_database', 'eu_path')

if st.button("Create database."):
    # Get data from source
    data = get_data(file_path=Path(file_path))

    # Getting neo4j credentials
    uri = configur.get('neo4j-graph', 'uri')
    username = configur.get('neo4j-graph', 'username')
    password = configur.get('neo4j-graph', 'password')

    # Create database
    db_create = create_graph(uri, username, password, data)

    if db_create['statusCode'] == 200:
        st.write("You have successfully loaded your dataset.")
    else:
        st.write(db_create["body"])
    
else:
    print("You have gotten an error while trying to create database.")
    st.write("You have gotten an error while trying to create database.")

